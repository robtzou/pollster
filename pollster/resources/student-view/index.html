<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Remote</title>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }

        /* Hidden by default */
        #poll-ui {
            display: none;
        }

        #waiting-ui {
            display: block;
            margin-top: 50px;
        }

        .btn-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-grid button {
            padding: 40px;
            font-size: 24px;
            border: 3px solid transparent;
            border-radius: 12px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: transform 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease;
        }

        .btn-grid button.selected {
            transform: scale(1.05);
            border-color: white;
            box-shadow: 0 0 16px rgba(255, 255, 255, 0.3);
        }

        .btn-grid button:disabled {
            opacity: 0.5;
            cursor: default;
            transform: none;
        }

        .btn-a {
            background: #e63946;
        }

        .btn-b {
            background: #457b9d;
        }

        .btn-c {
            background: #e9c46a;
            color: black;
        }

        .btn-d {
            background: #2a9d8f;
        }

        .btn-grid button:active:not(:disabled) {
            opacity: 0.7;
            transform: scale(0.98);
        }

        #confirm-btn {
            display: none;
            margin: 20px auto 0;
            padding: 16px 48px;
            font-size: 20px;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            background: #4cd137;
            color: #1a1a1a;
            cursor: pointer;
            transition: opacity 0.15s ease;
        }

        #confirm-btn:active {
            opacity: 0.7;
        }
    </style>
</head>

<body>

    <div id="waiting-ui">
        <h2>ðŸ‘€ Eyes on the board</h2>
        <p>Waiting for teacher to start...</p>
    </div>

    <div id="poll-ui">
        <h2 id="question-text">Question?</h2>
        <div class="btn-grid">
            <button class="btn-a" onclick="selectAnswer('A', this)">A</button>
            <button class="btn-b" onclick="selectAnswer('B', this)">B</button>
            <button class="btn-c" onclick="selectAnswer('C', this)">C</button>
            <button class="btn-d" onclick="selectAnswer('D', this)">D</button>
        </div>
        <button id="confirm-btn" onclick="confirmAnswer()">âœ“ Confirm Answer</button>
        <p id="sent-msg" style="display:none; color: #4cd137;">Answer Sent!</p>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // UI Elements
        const pollUI = document.getElementById('poll-ui');
        const waitingUI = document.getElementById('waiting-ui');
        const questionText = document.getElementById('question-text');
        const sentMsg = document.getElementById('sent-msg');
        const confirmBtn = document.getElementById('confirm-btn');

        let selectedAnswer = null;
        let submitted = false;

        // 1. LISTEN: Teacher starts poll
        socket.on('start-poll', (text) => {
            waitingUI.style.display = 'none';
            pollUI.style.display = 'block';
            questionText.innerText = text;
            sentMsg.style.display = 'none';
            sentMsg.innerText = 'Answer Sent!';
            confirmBtn.style.display = 'none';
            selectedAnswer = null;
            submitted = false;
            // Re-enable and deselect all buttons
            document.querySelectorAll('.btn-grid button').forEach(b => {
                b.disabled = false;
                b.classList.remove('selected');
            });
        });

        // 2. LISTEN: Teacher stops poll
        socket.on('stop-poll', () => {
            waitingUI.style.display = 'block';
            pollUI.style.display = 'none';
        });

        // 3. SELECT: Student taps an answer
        function selectAnswer(answer, btn) {
            if (submitted) return;
            selectedAnswer = answer;
            // Highlight only the selected button
            document.querySelectorAll('.btn-grid button').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            // Show the confirm button
            confirmBtn.style.display = 'block';
        }

        // 4. CONFIRM: Student locks in their answer
        function confirmAnswer() {
            if (!selectedAnswer || submitted) return;
            submitted = true;

            socket.emit('student-answer', selectedAnswer);

            navigator.vibrate(50);
            sentMsg.style.display = 'block';
            confirmBtn.style.display = 'none';

            // Disable all buttons
            document.querySelectorAll('.btn-grid button').forEach(b => b.disabled = true);
        }

        // Server rejected duplicate answer
        socket.on('already-answered', () => {
            sentMsg.innerText = 'You already answered this question!';
            sentMsg.style.display = 'block';
        });
    </script>
</body>

</html>